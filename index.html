<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Yunnan Romantic Journey Â· Interactive Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #020617;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.18);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border-soft: #1f2937;
      --lock: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow:
        0 20px 60px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      padding: 22px 22px 26px;
      backdrop-filter: blur(20px);
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }

    header h1 {
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
    }

    header h1 span.badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      background: linear-gradient(
        120deg,
        rgba(248, 250, 252, 0.06),
        rgba(249, 115, 22, 0.22)
      );
      border-radius: 999px;
      padding: 3px 10px;
      border: 1px solid rgba(249, 115, 22, 0.55);
      color: #fed7aa;
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-sub);
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      font-size: 0.78rem;
      color: #cbd5f5;
    }

    .meta-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.38);
      background: radial-gradient(
        circle at top left,
        rgba(129, 140, 248, 0.35),
        rgba(15, 23, 42, 0.9)
      );
    }

    .meta-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(249, 115, 22, 0.8);
    }

    .mode-banner {
      margin: 8px 0 16px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(
        circle at top left,
        rgba(248, 250, 252, 0.05),
        rgba(15, 23, 42, 0.95)
      );
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 0.86rem;
    }

    .mode-badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      border: 1px solid var(--accent);
      color: #fed7aa;
      background: var(--accent-soft);
    }

    .today-text {
      font-weight: 500;
      color: #e5e7eb;
    }

    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
      margin-top: 4px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 16px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(120deg, #f97316, #fb923c);
      color: #111827;
      box-shadow:
        0 10px 30px rgba(248, 113, 22, 0.65),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        filter 0.08s ease;
    }

    .btn span.icon {
      font-size: 1.05rem;
    }

    .btn.secondary {
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
      box-shadow: none;
      padding: 8px 13px;
    }

    .btn:hover {
      filter: brightness(1.02);
      transform: translateY(-1px);
      box-shadow:
        0 14px 35px rgba(248, 113, 22, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .btn.secondary:hover {
      box-shadow: 0 8px 25px rgba(15, 23, 42, 0.9);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow:
        0 8px 22px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .hint {
      font-size: 0.78rem;
      color: var(--text-sub);
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .card {
      position: relative;
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(
        circle at top left,
        rgba(15, 23, 42, 0.9),
        rgba(2, 6, 23, 0.98)
      );
      padding: 14px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: hidden;
      cursor: pointer;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top left,
        rgba(249, 115, 22, 0.12),
        transparent
      );
      pointer-events: none;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .day-label {
      font-size: 0.86rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .day-theme {
      font-size: 0.8rem;
      color: var(--text-sub);
    }

    .chip {
      font-size: 0.72rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 3px 8px;
      color: #a5b4fc;
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.8);
    }

    .chip.locked {
      color: var(--lock);
      border-color: rgba(75, 85, 99, 0.9);
    }

    .chip.locked .chip-dot {
      background: var(--lock);
      box-shadow: none;
    }

    .content {
      margin-top: 5px;
      font-size: 0.8rem;
      line-height: 1.5;
      color: var(--text-main);
      white-space: pre-line;
    }

    .locked-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top,
        rgba(15, 23, 42, 0.95),
        rgba(15, 23, 42, 0.98)
      );
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--lock);
      font-size: 0.82rem;
      pointer-events: none;
    }

    .locked-overlay span.lock-icon {
      font-size: 1.6rem;
    }

    @media (max-width: 640px) {
      .app {
        padding: 18px 16px 22px;
        border-radius: 18px;
      }
      header h1 {
        font-size: 1.25rem;
      }
      .mode-banner {
        flex-direction: column;
        align-items: flex-start;
      }
      .controls {
        flex-direction: column;
        align-items: flex-start;
      }
      .cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>
        Yunnan Romantic Journey
        <span class="badge">Interactive Â· Jerry &amp; Partner</span>
      </h1>
      <p>Before departure: trip â€œblind boxâ€. After departure: auto-unlocking daily story. âœ¨</p>
      <div class="meta-row">
        <div class="meta-chip">
          <span class="meta-dot"></span>
          <span>Trip dates: 2025-12-21 â†’ 2026-01-03</span>
        </div>
        <div class="meta-chip">
          <span>Route: Dali Â· Lugu Lake Â· Lijiang Â· Shangri-La Â· Feilai Temple</span>
        </div>
      </div>
    </header>

    <section id="modeBanner" class="mode-banner">
      <div>
        <div class="today-text" id="todayText"></div>
        <div id="modeText" style="margin-top: 4px;"></div>
      </div>
      <div class="mode-badge" id="modeBadge"></div>
    </section>

    <section class="controls">
      <div>
        <button id="randomBtn" class="btn">
          <span class="icon">ğŸ²</span>
          <span>Pick 3 random days</span>
        </button>
        <button id="resetBtn" class="btn secondary" style="display:none;">
          Reset picks
        </button>
      </div>
      <div class="hint" id="hintText"></div>
    </section>

    <section id="cards" class="cards"></section>
  </div>

  <!-- All logic + Firebase (v9) in one ES module -->
  <script type="module">
    // ==========================
    // 0. Firebase setup (fill your own config)
    // ==========================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // TODO: replace with your Firebase project config
    const firebaseConfig = {
    apiKey: "AIzaSyBKL-VoS_lDspkv0fEuCNA-_36raSGQ0HA",
    authDomain: "yunnan-jounery.firebaseapp.com",
    databaseURL: "https://yunnan-jounery-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "yunnan-jounery",
    storageBucket: "yunnan-jounery.firebasestorage.app",
    messagingSenderId: "213115475804",
    appId: "1:213115475804:web:946336958f101d4096d399",
    measurementId: "G-6Q9XCTY571"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function logEvent(eventType, payload = {}) {
      try {
        const eventsRef = ref(db, "tripEvents");
        push(eventsRef, {
          type: eventType,
          payload,
          ts: serverTimestamp()
        });
      } catch (e) {
        // Fail silently on logging errors
        console.warn("Firebase logEvent failed:", e);
      }
    }

    // ==========================
    // 1. Itinerary data
    // ==========================

    const itinerary = [
      {
        id: 1,
        date: "2025-12-21",
        label: "Day 1 Â· Dec 21 Â· Shenzhen â†’ Kunming â†’ Dali",
        theme: "First night in Dali ğŸŒ™",
        content: `â€¢ SZ â†’ Kunming âœˆï¸ HU7767 06:55â€“09:30
â€¢ Airport â†’ Kunming Railway Station â†’ high-speed train to Dali ğŸš„
â€¢ Check-in: guesthouse inside Dali Old Town
â€¢ Skip main street, go to â€œBedsheet Factoryâ€ art zone: coffee, books, quiet corners
â€¢ Night walk on Renmin Road, slow start of the trip`
      },
      {
        id: 2,
        date: "2025-12-22",
        label: "Day 2 Â· Dec 22 Â· Dali Â· Erhai loop",
        theme: "Private blue of Erhai ğŸ’™",
        content: `â€¢ Car (not e-scooter in winter) â†’ focus on west side eco-corridor
â€¢ Morning: Caicun or Longkan pier, sunrise + red cypress
â€¢ Stop at â€œBridgeâ€ & â€œCouple Treesâ€ for photos
â€¢ Lunch in Xizhou: Xizhou baba + simple local dishes
â€¢ Afternoon: coffee by the lake near Wenbi Village / Ideal Town
â€¢ Stay for Erhai sunset, back to Old Town for dinner`
      },
      {
        id: 3,
        date: "2025-12-23",
        label: "Day 3 Â· Dec 23 Â· Dali Â· Handcraft & Cangshan",
        theme: "Indigo dye & mountain view ğŸŒ€",
        content: `â€¢ Morning: private Bai tie-dye workshop near Xizhou
â€¢ Make a pair of couple coasters / small scarves as trip memory
â€¢ Lunch: simple local food in the village
â€¢ Afternoon: Jizhao Nunnery â€“ flowers, garden, vegetarian set
â€¢ Late afternoon: Gantong cable car to mid-level viewpoint
â€¢ View over Dali plain + Erhai at sunset`
      },
      {
        id: 4,
        date: "2025-12-24",
        label: "Day 4 Â· Dec 24 Â· Dali â†’ Lugu Lake",
        theme: "Road to the matriarchal lake âœ¨",
        content: `â€¢ Tourist bus / charter car to Lugu Lake (5â€“6 h, mountain road)
â€¢ Check-in: lake-view guesthouse in Lige or Daluoshui
â€¢ Short walk by the lakeshore, get used to the pace
â€¢ If available: join Mosuo bonfire night, songs + round dance ğŸ”¥`
      },
      {
        id: 5,
        date: "2025-12-25",
        label: "Day 5 Â· Dec 25 Â· Lugu Lake loop",
        theme: "Clouds on the water â˜ï¸",
        content: `â€¢ Car loop: Lige view deck â†’ Nisai Village â†’ Loversâ€™ Tree â†’ Goddess Bay
â€¢ Lunch at Goddess Bay or Zhao family bay
â€¢ Afternoon: Walking Marriage Bridge + Caohai
â€¢ Wooden â€œpig trough boatâ€ to the lake center, feed seagulls ğŸ›¶
â€¢ Quiet sunset stop at a less-crowded viewpoint`
      },
      {
        id: 6,
        date: "2025-12-26",
        label: "Day 6 Â· Dec 26 Â· Lugu Lake â†’ Lijiang",
        theme: "Soft time in Shuhe ğŸ˜ï¸",
        content: `â€¢ Morning drive back to Lijiang (about 4 h)
â€¢ Skip busy Dayan, check in at a guesthouse in Shuhe Old Town
â€¢ Terrace cafÃ© with Yulong Snow Mountain view â˜•ï¸
â€¢ Evening walk in stone alleys, listen to the stream`
      },
      {
        id: 7,
        date: "2025-12-27",
        label: "Day 7 Â· Dec 27 Â· Lijiang Â· Snow mountain",
        theme: "Snow peak & night lights ğŸ”ï¸",
        content: `â€¢ Option A: Yulong Snow Mountain day trip (cable car + Glacier Park + Blue Moon Valley)
â€¢ Option B: Yuhu Village â€“ stone village + quiet snow-mountain reflection
â€¢ Light horse ride / short hike if you feel like it
â€¢ Evening: dinner in Shuhe or Dayan Old Town
â€¢ View over Old Town lights from a rooftop / hill cafÃ©`
      },
      {
        id: 8,
        date: "2025-12-28",
        label: "Day 8 Â· Dec 28 Â· Lijiang â†’ Shangri-La",
        theme: "Tiger Leaping Gorge vibes ğŸ¯",
        content: `â€¢ Car / tourist bus Lijiang â†’ Shangri-La (about 4 h)
â€¢ Stop at Tiger Leaping Gorge viewing area, feel the Jinsha River power
â€¢ Check-in: warm Tibetan-style inn in Dukezong Old Town
â€¢ Slow pace, drink more water, adapt to altitude
â€¢ Sunset at Guishan Park, spin the giant prayer wheel for wishes`
      },
      {
        id: 9,
        date: "2025-12-29",
        label: "Day 9 Â· Dec 29 Â· Shangri-La",
        theme: "Monastery & grassland night ğŸ””",
        content: `â€¢ Morning: Ganden Sumtseling Monastery (â€œLittle Potalaâ€) with local guide
â€¢ Lunch: simple Tibetan set meal
â€¢ Afternoon: Napa Lake winter grassland, birds, wide open view
â€¢ Visit a nomad family if possible, try butter tea
â€¢ If sky is clear: short night walk to see plateau stars`
      },
      {
        id: 10,
        date: "2025-12-30",
        label: "Day 10 Â· Dec 30 Â· Shangri-La",
        theme: "Hidden lake or national park ğŸ’§",
        content: `â€¢ If weather/road is good: charter car to â€œBottomless Lakeâ€ â€“ quiet alpine lake, light picnic
â€¢ If not: switch to Pudacuo National Park (open parts)
â€¢ Back to Dukezong Old Town, early rest for New Yearâ€™s Eve`
      },
      {
        id: 11,
        date: "2025-12-31",
        label: "Day 11 Â· Dec 31 Â· Shangri-La â†’ Feilai Temple",
        theme: "NYE under Meili stars ğŸŒŒ",
        content: `â€¢ Drive along Yunnanâ€“Tibet road to Deqin / Feilai Temple
â€¢ Photo stop at Jinsha River Big Bend
â€¢ Check-in: hotel facing Meili (big window + heating / oxygen)
â€¢ New Yearâ€™s Eve: hot drink, watch last sunset on Kawagarbo
â€¢ If clear: starry sky above Meili, indoor stargazing night`
      },
      {
        id: 12,
        date: "2026-01-01",
        label: "Day 12 Â· Jan 1 Â· Feilai Temple & Mingyong Glacier",
        theme: "First light of the year ğŸŒ…",
        content: `â€¢ Early wake-up, quietly wait for possible â€œgolden sunriseâ€ on Meili
â€¢ Ritual moment even if no perfect golden light
â€¢ If energy is fine: drive to Mingyong Glacier, hike to view deck
â€¢ Afternoon: back to hotel, slow New Year afternoon`
      },
      {
        id: 13,
        date: "2026-01-02",
        label: "Day 13 Â· Jan 2 Â· Deqin â†’ Shangri-La â†’ Kunming",
        theme: "Goodbye to the plateau ğŸ§³",
        content: `â€¢ Morning drive Deqin â†’ Shangri-La (about 5 h)
â€¢ Best: evening flight Shangri-La â†’ Kunming âœˆï¸
â€¢ Backup: overnight bus Shangri-La â†’ Kunming (less comfy)
â€¢ Stay near Kunming Airport, long shower + good sleep`
      },
      {
        id: 14,
        date: "2026-01-03",
        label: "Day 14 Â· Jan 3 Â· Kunming â†’ Shenzhen",
        theme: "Back to daily life, with memories ğŸ“–",
        content: `â€¢ Easy morning; if time allows: Green Lake Park + seagulls
â€¢ Head to Kunming Changshui Airport
â€¢ CA3558 Kunming â†’ Shenzhen 13:15â€“15:15
â€¢ Trip ends, but â€œYunnan chapterâ€ stays in both of your stories`
      }
    ];

    // ==========================
    // 2. Date helpers
    // ==========================

    const STORAGE_KEY_RANDOM = "yn_trip_random_days_v1";

    function formatDateDisplay(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function getTodayDateOnly() {
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate());
    }

    const firstDate = new Date(itinerary[0].date);
    const lastDate = new Date(itinerary[itinerary.length - 1].date);

    function getMode() {
      const today = getTodayDateOnly();
      if (today < firstDate) return "pre";
      if (today > lastDate) return "post";
      return "during";
    }

    function loadRandomDays() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_RANDOM);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr)) return [];
        return arr;
      } catch (e) {
        return [];
      }
    }

    function saveRandomDays(ids) {
      localStorage.setItem(STORAGE_KEY_RANDOM, JSON.stringify(ids));
    }

    function resetRandomDays() {
      localStorage.removeItem(STORAGE_KEY_RANDOM);
    }

    function pickRandomDistinctDays(n) {
      const ids = itinerary.map((d) => d.id);
      // shuffle
      for (let i = ids.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [ids[i], ids[j]] = [ids[j], ids[i]];
      }
      return ids.slice(0, n);
    }

    // ==========================
    // 3. DOM + render
    // ==========================

    const todayTextEl = document.getElementById("todayText");
    const modeTextEl = document.getElementById("modeText");
    const modeBadgeEl = document.getElementById("modeBadge");
    const cardsEl = document.getElementById("cards");
    const randomBtn = document.getElementById("randomBtn");
    const resetBtn = document.getElementById("resetBtn");
    const hintTextEl = document.getElementById("hintText");

    function render() {
      const mode = getMode();
      const today = getTodayDateOnly();
      todayTextEl.textContent = `Today: ${formatDateDisplay(today)}`;

      if (mode === "pre") {
        modeBadgeEl.textContent = "Before trip Â· blind box mode";
        modeTextEl.textContent =
          "She can sneak peek 3 random days before the real journey starts. ğŸ";
        randomBtn.style.display = "inline-flex";
        resetBtn.style.display = "inline-flex";
        renderPreTrip();
      } else if (mode === "during") {
        modeBadgeEl.textContent = "On the road Â· daily unlock";
        modeTextEl.textContent =
          "From Day 1 to today will auto-unlock; later days stay locked as surprises.";
        randomBtn.style.display = "none";
        resetBtn.style.display = "none";
        renderDuringTrip(today);
      } else {
        modeBadgeEl.textContent = "After trip Â· memory mode";
        modeTextEl.textContent =
          "All days are unlocked now, like a small online travel diary. ğŸ“";
        randomBtn.style.display = "none";
        resetBtn.style.display = "none";
        renderPostTrip();
      }
    }

    function renderPreTrip() {
      const selectedIds = loadRandomDays();
      cardsEl.innerHTML = "";

      if (!selectedIds.length) {
        hintTextEl.textContent =
          "Tip: click â€œPick 3 random daysâ€ and let her draw a mini preview of the trip.";
        return;
      }

      hintTextEl.textContent =
        "3 days selected. You can reset and draw again if you want.";

      const selectedDays = itinerary
        .filter((d) => selectedIds.includes(d.id))
        .sort((a, b) => new Date(a.date) - new Date(b.date));

      selectedDays.forEach((day) => {
        cardsEl.appendChild(createCard(day, { unlocked: true }));
      });
    }

    function renderDuringTrip(today) {
      cardsEl.innerHTML = "";
      hintTextEl.textContent =
        "Green dot = unlocked; lock icon = future surprise.";

      itinerary.forEach((day) => {
        const dayDate = new Date(day.date);
        const unlocked = dayDate <= today;
        cardsEl.appendChild(createCard(day, { unlocked }));
      });
    }

    function renderPostTrip() {
      cardsEl.innerHTML = "";
      hintTextEl.textContent =
        "All days unlocked. You can scroll through and replay the whole story anytime.";

      itinerary.forEach((day) => {
        cardsEl.appendChild(createCard(day, { unlocked: true }));
      });
    }

    function createCard(day, options) {
      const { unlocked } = options;
      const card = document.createElement("article");
      card.className = "card";
      card.dataset.dayId = day.id;

      const headerRow = document.createElement("div");
      headerRow.className = "card-header-row";

      const left = document.createElement("div");

      const label = document.createElement("div");
      label.className = "day-label";
      label.textContent = day.label;

      const theme = document.createElement("div");
      theme.className = "day-theme";
      theme.textContent = day.theme;

      left.appendChild(label);
      left.appendChild(theme);

      const chip = document.createElement("div");
      chip.className = "chip" + (unlocked ? "" : " locked");

      const dot = document.createElement("div");
      dot.className = "chip-dot";
      chip.appendChild(dot);

      const chipText = document.createElement("span");
      chipText.textContent = unlocked ? "Unlocked" : "Locked (future day)";
      chip.appendChild(chipText);

      headerRow.appendChild(left);
      headerRow.appendChild(chip);

      const content = document.createElement("div");
      content.className = "content";
      content.textContent = day.content;

      card.appendChild(headerRow);
      card.appendChild(content);

      if (!unlocked) {
        const overlay = document.createElement("div");
        overlay.className = "locked-overlay";
        const icon = document.createElement("span");
        icon.className = "lock-icon";
        icon.textContent = "ğŸ”’";
        const text = document.createElement("div");
        text.textContent = "This day will unlock when you actually reach it.";
        overlay.appendChild(icon);
        overlay.appendChild(text);
        card.appendChild(overlay);
      }

      card.addEventListener("click", () => {
        logEvent("open_day_card", {
          dayId: day.id,
          date: day.date,
          unlocked
        });
      });

      return card;
    }

    // ==========================
    // 4. Events
    // ==========================

    randomBtn.addEventListener("click", () => {
      const ids = pickRandomDistinctDays(3);
      saveRandomDays(ids);
      logEvent("random_pick", { pickedIds: ids });
      render();
    });

    resetBtn.addEventListener("click", () => {
      resetRandomDays();
      logEvent("reset_random_pick");
      render();
    });

    // initial render
    logEvent("page_view", { tsLocal: Date.now() });
    render();
  </script>
</body>
</html>