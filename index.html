<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Yunnan Journey ¬∑ Jerry & Kat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #070709;
      --bg-card: rgba(15, 15, 22, 0.9);
      --bg-glass: rgba(255, 255, 255, 0.02);
      --accent-gold: #d4a574;
      --accent-gold-light: #e8c9a0;
      --accent-teal: #6bb8b8;
      --accent-rose: #c9a0a0;
      --text-cream: #f5f0e8;
      --text-muted: #8a8580;
      --text-dim: #5a5550;
      --border-glow: rgba(212, 165, 116, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.06);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      min-height: 100vh;
      font-family: 'Cormorant Garamond', Georgia, serif;
      background: var(--bg-deep);
      color: var(--text-cream);
      line-height: 1.7;
      overflow-x: hidden;
    }

    /* Atmospheric Background */
    .atmosphere {
      position: fixed;
      inset: 0;
      z-index: -3;
      background: 
        radial-gradient(ellipse 120% 60% at 10% 0%, rgba(212, 165, 116, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse 80% 80% at 90% 100%, rgba(107, 184, 184, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 50% 50%, rgba(201, 160, 160, 0.04) 0%, transparent 50%);
    }

    /* Aurora effect */
    .aurora {
      position: fixed;
      inset: 0;
      z-index: -2;
      opacity: 0.4;
      filter: blur(100px);
      animation: auroraShift 30s ease-in-out infinite;
    }

    .aurora::before,
    .aurora::after {
      content: '';
      position: absolute;
      border-radius: 50%;
    }

    .aurora::before {
      width: 60vw;
      height: 60vh;
      top: -20%;
      left: -10%;
      background: radial-gradient(circle, rgba(212, 165, 116, 0.3) 0%, transparent 70%);
      animation: float1 20s ease-in-out infinite;
    }

    .aurora::after {
      width: 50vw;
      height: 50vh;
      bottom: -10%;
      right: -10%;
      background: radial-gradient(circle, rgba(107, 184, 184, 0.25) 0%, transparent 70%);
      animation: float2 25s ease-in-out infinite;
    }

    @keyframes auroraShift {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.6; }
    }

    @keyframes float1 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(10%, 5%) scale(1.1); }
      66% { transform: translate(-5%, 10%) scale(0.95); }
    }

    @keyframes float2 {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-10%, -5%) scale(1.15); }
    }

    /* Stars */
    .stars-container {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .star {
      position: absolute;
      border-radius: 50%;
      background: #fff;
    }

    .star.dust { width: 1px; height: 1px; opacity: 0.3; }
    .star.small { width: 1.5px; height: 1.5px; animation: pulse 3s ease-in-out infinite; }
    .star.medium { width: 2px; height: 2px; animation: pulse 4s ease-in-out infinite; box-shadow: 0 0 6px rgba(255,255,255,0.5); }
    .star.bright { width: 3px; height: 3px; animation: pulse 5s ease-in-out infinite; box-shadow: 0 0 10px rgba(212, 165, 116, 0.6), 0 0 20px rgba(212, 165, 116, 0.3); }

    @keyframes pulse {
      0%, 100% { opacity: 0.4; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* Shooting stars */
    .meteor {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 0 6px 2px rgba(255,255,255,0.6), -80px 0 20px 1px rgba(255,255,255,0.3);
      animation: meteor 8s linear infinite;
      opacity: 0;
    }

    @keyframes meteor {
      0% { transform: translate(0, 0); opacity: 0; }
      5% { opacity: 1; }
      15% { transform: translate(300px, 150px); opacity: 0; }
      100% { opacity: 0; }
    }

    /* Container */
    .container {
      max-width: 920px;
      margin: 0 auto;
      padding: 60px 28px 100px;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 40px 0 60px;
      position: relative;
    }

    .hero-ornament {
      font-size: 1.5rem;
      color: var(--accent-gold);
      opacity: 0.4;
      letter-spacing: 1.5rem;
      margin-bottom: 30px;
      animation: fadeIn 1.5s ease forwards;
    }

    .hero h1 {
      font-size: clamp(2.2rem, 6vw, 3.5rem);
      font-weight: 500;
      letter-spacing: 0.08em;
      color: var(--text-cream);
      margin-bottom: 16px;
      opacity: 0;
      animation: slideUp 1s ease forwards 0.3s;
    }

    .hero-subtitle {
      font-size: 1.15rem;
      font-style: italic;
      color: var(--text-muted);
      margin-bottom: 28px;
      opacity: 0;
      animation: slideUp 1s ease forwards 0.5s;
    }

    .hero-names {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      padding: 12px 32px;
      background: var(--bg-glass);
      border: 1px solid var(--border-glow);
      border-radius: 100px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      letter-spacing: 0.15em;
      color: var(--accent-gold);
      opacity: 0;
      animation: slideUp 1s ease forwards 0.7s;
    }

    .hero-names .separator {
      width: 24px;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Route Flow */
    .route-flow {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0;
      margin-top: 40px;
      opacity: 0;
      animation: slideUp 1s ease forwards 0.9s;
    }

    .route-node {
      display: flex;
      align-items: center;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.75rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .route-node::after {
      content: '';
      width: 30px;
      height: 1px;
      background: linear-gradient(90deg, var(--accent-gold) 0%, transparent 100%);
      margin: 0 12px;
      opacity: 0.4;
    }

    .route-node:last-child::after { display: none; }

    .route-node span {
      transition: color 0.3s ease;
    }

    .route-node:hover span {
      color: var(--accent-gold);
    }

    /* Info Panel */
    .info-panel {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1px;
      margin: 50px 0;
      background: var(--border-subtle);
      border-radius: 20px;
      overflow: hidden;
      opacity: 0;
      animation: slideUp 1s ease forwards 1.1s;
    }

    .info-cell {
      background: var(--bg-card);
      padding: 28px 20px;
      text-align: center;
      transition: background 0.3s ease;
    }

    .info-cell:hover {
      background: rgba(25, 25, 35, 0.95);
    }

    .info-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      margin-bottom: 8px;
    }

    .info-value {
      font-size: 1rem;
      color: var(--text-cream);
    }

    /* Status Banner */
    .status-banner {
      text-align: center;
      padding: 36px 28px;
      margin: 40px 0;
      background: linear-gradient(135deg, rgba(212, 165, 116, 0.08) 0%, rgba(107, 184, 184, 0.05) 100%);
      border: 1px solid var(--border-glow);
      border-radius: 24px;
      position: relative;
      overflow: hidden;
    }

    .status-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
    }

    .status-mode {
      display: inline-block;
      padding: 6px 18px;
      background: var(--accent-gold);
      color: var(--bg-deep);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border-radius: 100px;
      margin-bottom: 14px;
    }

    .status-title {
      font-size: 1.1rem;
      color: var(--text-cream);
      margin-bottom: 8px;
    }

    .status-desc {
      font-size: 0.95rem;
      color: var(--text-muted);
      font-style: italic;
    }

    /* Countdown */
    .countdown {
      display: flex;
      justify-content: center;
      gap: 28px;
      margin-top: 20px;
    }

    .countdown-item {
      text-align: center;
    }

    .countdown-num {
      font-family: 'DM Sans', sans-serif;
      font-size: 2.5rem;
      font-weight: 500;
      color: var(--accent-gold);
      line-height: 1;
      text-shadow: 0 0 30px rgba(212, 165, 116, 0.4);
    }

    .countdown-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      margin-top: 6px;
    }

    /* Current Day Highlight */
    .current-day-banner {
      text-align: center;
      padding: 40px 28px;
      margin: 40px 0;
      background: linear-gradient(135deg, rgba(107, 184, 184, 0.12) 0%, rgba(212, 165, 116, 0.08) 100%);
      border: 1px solid rgba(107, 184, 184, 0.25);
      border-radius: 24px;
      position: relative;
    }

    .current-day-banner::after {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 24px;
      background: linear-gradient(135deg, var(--accent-teal), var(--accent-gold));
      z-index: -1;
      opacity: 0.3;
      filter: blur(20px);
    }

    .current-day-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--accent-teal);
      margin-bottom: 12px;
    }

    .current-day-title {
      font-size: 1.8rem;
      color: var(--text-cream);
      margin-bottom: 8px;
    }

    .current-day-theme {
      font-size: 1.1rem;
      font-style: italic;
      color: var(--accent-gold-light);
    }

    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 40px;
      margin-top: 50px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: linear-gradient(180deg, 
        var(--accent-gold) 0%, 
        var(--accent-teal) 40%,
        var(--accent-rose) 70%,
        var(--accent-gold) 100%
      );
      opacity: 0.3;
    }

    /* Day Card */
    .day-card {
      position: relative;
      margin-bottom: 24px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(20px);
    }

    .day-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .day-card::before {
      content: '';
      position: absolute;
      left: -32px;
      top: 32px;
      width: 12px;
      height: 12px;
      background: var(--bg-deep);
      border: 2px solid var(--text-dim);
      border-radius: 50%;
      transition: all 0.3s ease;
      z-index: 2;
    }

    .day-card.unlocked::before {
      background: var(--accent-teal);
      border-color: var(--accent-teal);
      box-shadow: 0 0 12px rgba(107, 184, 184, 0.6);
    }

    .day-card.today::before {
      background: var(--accent-gold);
      border-color: var(--accent-gold);
      box-shadow: 0 0 16px rgba(212, 165, 116, 0.8);
      animation: todayPulse 2s ease-in-out infinite;
    }

    @keyframes todayPulse {
      0%, 100% { box-shadow: 0 0 16px rgba(212, 165, 116, 0.8); }
      50% { box-shadow: 0 0 24px rgba(212, 165, 116, 1), 0 0 40px rgba(212, 165, 116, 0.5); }
    }

    .day-card.unlocked:hover {
      transform: translateX(8px);
      border-color: var(--border-glow);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3), 0 0 60px rgba(212, 165, 116, 0.1);
    }

    .day-card.locked {
      opacity: 0.4;
    }

    .day-card.locked:hover {
      transform: none;
    }

    /* Card Header */
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 28px;
      cursor: pointer;
    }

    .day-card.locked .card-header {
      cursor: default;
    }

    .card-date {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.7rem;
      color: var(--accent-gold);
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 500;
      color: var(--text-cream);
      margin-bottom: 6px;
    }

    .card-theme {
      font-size: 0.95rem;
      font-style: italic;
      color: var(--text-muted);
    }

    .card-status {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: rgba(107, 184, 184, 0.1);
      border: 1px solid rgba(107, 184, 184, 0.2);
      border-radius: 100px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-teal);
    }

    .card-status.locked {
      background: rgba(90, 85, 80, 0.1);
      border-color: rgba(90, 85, 80, 0.2);
      color: var(--text-dim);
    }

    .card-status.today {
      background: rgba(212, 165, 116, 0.15);
      border-color: rgba(212, 165, 116, 0.3);
      color: var(--accent-gold);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .card-status.today .status-dot {
      animation: statusPulse 1.5s ease-in-out infinite;
    }

    @keyframes statusPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .expand-icon {
      font-size: 0.8rem;
      color: var(--text-muted);
      transition: transform 0.3s ease;
      margin-left: 12px;
    }

    .day-card.expanded .expand-icon {
      transform: rotate(180deg);
    }

    /* Card Body */
    .card-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-body.expanded {
      max-height: 1500px;
    }

    .card-content {
      padding: 0 28px 28px;
    }

    /* Story Section */
    .story-box {
      padding: 20px 24px;
      background: linear-gradient(135deg, rgba(212, 165, 116, 0.06) 0%, transparent 100%);
      border-left: 2px solid var(--accent-gold);
      border-radius: 0 12px 12px 0;
      margin-bottom: 24px;
    }

    .story-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent-gold);
      margin-bottom: 10px;
    }

    .story-text {
      font-size: 1rem;
      font-style: italic;
      color: var(--text-muted);
      line-height: 1.9;
    }

    /* Schedule */
    .schedule-section {
      margin-bottom: 24px;
    }

    .schedule-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      margin-bottom: 16px;
    }

    .schedule-item {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .schedule-item:last-child {
      border-bottom: none;
    }

    .schedule-time {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.75rem;
      color: var(--accent-gold);
      min-width: 70px;
      padding-top: 2px;
    }

    .schedule-dot {
      width: 6px;
      height: 6px;
      background: var(--accent-teal);
      border-radius: 50%;
      margin-top: 8px;
      flex-shrink: 0;
    }

    .schedule-text {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    /* Hotel Section */
    .hotel-box {
      padding: 24px;
      background: rgba(107, 184, 184, 0.05);
      border: 1px solid rgba(107, 184, 184, 0.1);
      border-radius: 16px;
    }

    .hotel-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent-teal);
      margin-bottom: 10px;
    }

    .hotel-name {
      font-size: 1.1rem;
      color: var(--text-cream);
      margin-bottom: 4px;
    }

    .hotel-location {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .hotel-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .hotel-btn {
      padding: 10px 20px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.8rem;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .hotel-btn.primary {
      background: var(--accent-gold);
      color: var(--bg-deep);
    }

    .hotel-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(212, 165, 116, 0.3);
    }

    .hotel-btn.secondary {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border-subtle);
    }

    .hotel-btn.secondary:hover {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }

    .room-pref {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed var(--border-subtle);
    }

    .room-pref-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      color: var(--text-dim);
      margin-bottom: 4px;
    }

    .room-pref-value {
      font-size: 0.9rem;
      color: var(--accent-teal);
    }

    /* Locked Overlay */
    .locked-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(7, 7, 9, 0.85);
      backdrop-filter: blur(4px);
      border-radius: 20px;
    }

    .lock-icon {
      font-size: 1.8rem;
      margin-bottom: 10px;
      opacity: 0.6;
    }

    .lock-text {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.8rem;
      color: var(--text-dim);
      letter-spacing: 0.05em;
    }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px;
      margin: 36px 0;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      border: none;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-light) 100%);
      color: var(--bg-deep);
      box-shadow: 0 8px 32px rgba(212, 165, 116, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(212, 165, 116, 0.4);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border-subtle);
    }

    .btn-secondary:hover {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }

    .hint {
      text-align: center;
      font-size: 0.9rem;
      font-style: italic;
      color: var(--text-dim);
      margin: 20px 0 36px;
    }

    /* Placeholder */
    .placeholder {
      text-align: center;
      padding: 60px 30px;
      background: var(--bg-card);
      border: 1px dashed var(--border-subtle);
      border-radius: 24px;
    }

    .placeholder-icon {
      font-size: 3rem;
      margin-bottom: 20px;
      opacity: 0.6;
    }

    .placeholder-text {
      font-size: 1.1rem;
      color: var(--text-cream);
      margin-bottom: 8px;
    }

    .placeholder-sub {
      font-size: 0.9rem;
      color: var(--text-dim);
    }

    /* Cards Grid */
    .cards-grid {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* Footer */
    .footer-note {
      text-align: center;
      margin-top: 80px;
      padding-top: 40px;
      border-top: 1px solid var(--border-subtle);
    }

    .footer-note p {
      font-size: 1rem;
      font-style: italic;
      color: var(--text-dim);
    }

    .footer-ornament {
      margin-top: 20px;
      font-size: 0.9rem;
      letter-spacing: 0.8rem;
      color: var(--accent-gold);
      opacity: 0.3;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      width: 90%;
      max-width: 900px;
      height: 80vh;
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      border-radius: 24px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 28px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .modal-title {
      font-size: 1.2rem;
      color: var(--text-cream);
    }

    .modal-close {
      width: 36px;
      height: 36px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 50%;
      color: var(--text-muted);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }

    .modal-body {
      flex: 1;
      overflow: hidden;
    }

    .modal-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .modal-footer {
      padding: 20px 28px;
      border-top: 1px solid var(--border-subtle);
    }

    .modal-room-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .modal-room-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      color: var(--text-cream);
      font-family: inherit;
      font-size: 0.95rem;
    }

    .modal-room-input::placeholder {
      color: var(--text-dim);
    }

    .modal-room-input:focus {
      outline: none;
      border-color: var(--accent-gold);
    }

    .modal-save-btn {
      margin-top: 12px;
      padding: 12px 24px;
      background: var(--accent-gold);
      color: var(--bg-deep);
      border: none;
      border-radius: 100px;
      font-family: inherit;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-save-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 165, 116, 0.3);
    }

    /* Responsive */
    @media (max-width: 640px) {
      .container { padding: 40px 20px 80px; }
      .hero { padding: 30px 0 50px; }
      .info-panel { grid-template-columns: 1fr; }
      .timeline { padding-left: 32px; }
      .day-card::before { left: -24px; }
      .card-header { flex-direction: column; gap: 14px; }
      .countdown { gap: 20px; }
      .countdown-num { font-size: 2rem; }
      .route-flow { gap: 4px 0; }
      .route-node::after { width: 20px; margin: 0 8px; }
    }

    /* Stagger animations */
    .stagger-1 { transition-delay: 0.05s; }
    .stagger-2 { transition-delay: 0.1s; }
    .stagger-3 { transition-delay: 0.15s; }
    .stagger-4 { transition-delay: 0.2s; }
    .stagger-5 { transition-delay: 0.25s; }
    .stagger-6 { transition-delay: 0.3s; }
    .stagger-7 { transition-delay: 0.35s; }
  </style>
</head>
<body>
  <div class="atmosphere"></div>
  <div class="aurora"></div>
  <div class="stars-container" id="stars"></div>

  <div class="container">
    <header class="hero">
      <div class="hero-ornament">‚ú¶ ‚ú¶ ‚ú¶</div>
      <h1>Yunnan Journey</h1>
      <p class="hero-subtitle">Through mountains, lakes, and snow</p>
      <div class="hero-names">
        <span>JERRY</span>
        <span class="separator"></span>
        <span>KAT</span>
      </div>

      <div class="route-flow">
        <div class="route-node"><span>Dali</span></div>
        <div class="route-node"><span>Erhai</span></div>
        <div class="route-node"><span>Lugu Lake</span></div>
        <div class="route-node"><span>Lijiang</span></div>
        <div class="route-node"><span>Shangri-La</span></div>
        <div class="route-node"><span>Meili</span></div>
      </div>
    </header>

    <section class="info-panel">
      <div class="info-cell">
        <div class="info-label">Dates</div>
        <div class="info-value">Dec 21, 2025 ‚Üí Jan 3, 2026</div>
      </div>
      <div class="info-cell">
        <div class="info-label">Duration</div>
        <div class="info-value">14 Days</div>
      </div>
      <div class="info-cell">
        <div class="info-label">Highlight</div>
        <div class="info-value">New Year at Meili</div>
      </div>
    </section>

    <section class="status-banner" id="statusBanner">
      <div class="status-mode" id="statusMode">Journey Mode</div>
      <div class="status-title" id="statusTitle">Today: <span id="todayDate"></span></div>
      <div class="status-desc" id="statusDesc">Days unlock as you travel</div>
      <div class="countdown" id="countdown"></div>
    </section>

    <section id="currentDayBanner"></section>

    <section class="controls" id="controls" style="display: none;">
      <button class="btn btn-primary" id="randomBtn">‚ú¶ Pick 3 Random Days</button>
      <button class="btn btn-secondary" id="resetBtn" style="display: none;">Reset</button>
    </section>

    <p class="hint" id="hint"></p>

    <section id="cardsContainer"></section>

    <footer class="footer-note">
      <p>See you in Yunnan.</p>
      <div class="footer-ornament">¬∑ ¬∑ ¬∑</div>
    </footer>
  </div>

  <!-- Hotel Modal -->
  <div class="modal-overlay" id="hotelModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Hotel Details</div>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <div class="modal-body">
        <iframe class="modal-iframe" id="modalIframe" src=""></iframe>
      </div>
      <div class="modal-footer">
        <div class="modal-room-label">Which room catches your eye? Note it here:</div>
        <input type="text" class="modal-room-input" id="modalRoomInput" placeholder="e.g. Mountain View Suite, Lakeside Room...">
        <button class="modal-save-btn" id="modalSaveBtn">Save Preference</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBKL-VoS_lDspkv0fEuCNA-_36raSGQ0HA",
      authDomain: "yunnan-jounery.firebaseapp.com",
      databaseURL: "https://yunnan-jounery-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "yunnan-jounery",
      storageBucket: "yunnan-jounery.firebasestorage.app",
      messagingSenderId: "213115475804",
      appId: "1:213115475804:web:946336958f101d4096d399"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function logEvent(eventType, payload = {}) {
      try {
        push(ref(db, "tripEvents"), {
          type: eventType,
          payload,
          ts: serverTimestamp(),
          localTime: new Date().toISOString()
        });
      } catch (e) { console.warn("Log failed:", e); }
    }

    // Itinerary Data
    const itinerary = [
      {
        id: 1, date: "2025-12-21", label: "Day 1 ¬∑ Dec 21", route: "Shenzhen ‚Üí Kunming ‚Üí Dali",
        theme: "First night in Dali",
        story: "The journey begins before dawn. As the plane lifts off from Shenzhen, the first chapter of our Yunnan story starts. By late afternoon, we'll be wandering the quiet lanes of Dali Old Town, far from the tourist crowds.",
        schedule: [
          { time: "06:55", text: "Flight HU7767 departs Shenzhen" },
          { time: "09:30", text: "Arrive Kunming, transfer to railway station" },
          { time: "12:58", text: "üöÑ D3936 Kunming ‚Üí Dali" },
          { time: "15:05", text: "Arrive Dali, taxi to Old Town" },
          { time: "Evening", text: "Check in, explore 'Bedsheet Factory' art zone" },
          { time: "Night", text: "Slow walk on Renmin Road" }
        ],
        hotel: { name: "Wolan Yinshe (ÂçßÂ≤öÈöêÂ•¢)", location: "Dali Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=131959162&checkIn=2025-12-21&checkOut=2025-12-22&locale=zh-HK" },
        protected: false
      },
      {
        id: 2, date: "2025-12-22", label: "Day 2 ¬∑ Dec 22", route: "Dali ¬∑ Erhai + Zhemo Mountain",
        theme: "Erhai blue & La La Land sunset",
        story: "Today belongs to Erhai Lake in the morning, and the famous Zhemo Mountain at sunset. We'll chase the morning light at Caicun pier, then end the day at 'Dali's La La Land' ‚Äî watching the sun set over wind turbines and endless grasslands.",
        schedule: [
          { time: "Sunrise", text: "Caicun or Longkan pier ‚Äî red cypress & first light" },
          { time: "Morning", text: "West shore eco-corridor drive" },
          { time: "Noon", text: "Xizhou village lunch: local baba + simple dishes" },
          { time: "Afternoon", text: "Lakeside caf√© near Wenbi Village" },
          { time: "16:00", text: "Drive to Zhemo Mountain (1.5 hours)" },
          { time: "Sunset", text: "üé¨ Zhemo Mountain ‚Äî La La Land vibes, windmills & golden hour" }
        ],
        hotel: { name: "Wolan Yinshe (ÂçßÂ≤öÈöêÂ•¢)", location: "Dali Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=131959162&checkIn=2025-12-22&checkOut=2025-12-23&locale=zh-HK" },
        protected: false
      },
      {
        id: 3, date: "2025-12-23", label: "Day 3 ¬∑ Dec 23", route: "Dali ‚Üí Shuanglang",
        theme: "Tie-dye workshop & mountain view",
        story: "We'll get our hands dirty today ‚Äî literally. At a Bai village workshop, we'll learn the ancient art of tie-dye and make matching coasters as our trip keepsake. Then, a cable car ride up Cangshan for one last sweeping view before we move to Shuanglang.",
        schedule: [
          { time: "Morning", text: "üé® Private Bai tie-dye workshop near Xizhou" },
          { time: "", text: "Make matching coasters ‚Äî our trip keepsake" },
          { time: "Noon", text: "Simple village lunch" },
          { time: "Afternoon", text: "Jizhao Nunnery: garden & vegetarian set" },
          { time: "Evening", text: "Gantong cable car up Cangshan, then drive to Shuanglang" }
        ],
        hotel: { name: "Banyue Tuolan Lake View (ÂçäÊúàÊãñËìù)", location: "Erhai ¬∑ Shuanglang", link: "https://hk.trip.com/hotels/detail/?hotelId=1922343&checkIn=2025-12-23&checkOut=2025-12-24&locale=zh-HK" },
        protected: false
      },
      {
        id: 4, date: "2025-12-24", label: "Day 4 ¬∑ Dec 24", route: "Shuanglang ‚Üí Lugu Lake",
        theme: "Road to the matriarchal lake",
        story: "A long mountain road takes us deeper into Yunnan, to Lugu Lake ‚Äî home of the Mosuo people and their walking marriages. If we're lucky, there'll be a bonfire tonight under stars we've never seen.",
        schedule: [
          { time: "Morning", text: "Leave Shuanglang, begin the 5-6 hour drive" },
          { time: "", text: "Wind through mountain roads and small villages" },
          { time: "Afternoon", text: "Arrive Lugu Lake, check into lakeside guesthouse" },
          { time: "Evening", text: "Short lakeside walk to settle in" },
          { time: "Night", text: "Mosuo bonfire if available ‚Äî songs & round dance" }
        ],
        hotel: { name: "Xujiu Shanhai (ÂèôÊóßÂ±±Êµ∑)", location: "Lugu Lake", link: "https://hk.trip.com/hotels/detail/?hotelId=91407674&checkIn=2025-12-24&checkOut=2025-12-25&locale=zh-HK" },
        protected: false
      },
      {
        id: 5, date: "2025-12-25", label: "Day 5 ¬∑ Dec 25", route: "Lugu Lake Loop",
        theme: "Clouds on the water",
        story: "Christmas at a lake so clear you can see the sky in it. We'll drift in a wooden pig-trough boat, feed the seagulls, and find our own secret spot to watch the day end.",
        schedule: [
          { time: "Morning", text: "Car loop: Lige deck ‚Üí Nisai ‚Üí Lovers' Tree" },
          { time: "Noon", text: "Lunch at Goddess Bay" },
          { time: "Afternoon", text: "Walking Marriage Bridge + Caohai wetland" },
          { time: "", text: "Pig-trough boat ride, feed the seagulls" },
          { time: "Sunset", text: "Find a quiet viewpoint, just us" }
        ],
        hotel: { name: "Qianshanji (ÂçÉÂ±±Áªß)", location: "Lugu Lake", link: "https://hk.trip.com/hotels/detail/?hotelId=90810005&checkIn=2025-12-25&checkOut=2025-12-26&locale=zh-HK" },
        protected: false
      },
      {
        id: 6, date: "2025-12-26", label: "Day 6 ¬∑ Dec 26", route: "Lugu Lake ‚Üí Lijiang",
        theme: "Slow time in Shuhe",
        story: "We leave the lake behind and head to Lijiang ‚Äî but not the busy ancient town everyone knows. Shuhe is quieter, older, with streams running through stone streets. A place to catch our breath.",
        schedule: [
          { time: "Morning", text: "4-hour drive back to Lijiang" },
          { time: "Afternoon", text: "Check in at Shuhe Old Town" },
          { time: "", text: "Terrace caf√© with Jade Dragon Snow Mountain view" },
          { time: "Evening", text: "Wander stone alleys, listen to the streams" }
        ],
        hotel: { name: "Yueshi Yunyue Holiday Villa (ÈòÖÊó∂‰∫ëÁ∫¶)", location: "Shuhe Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=126736658&checkIn=2025-12-26&checkOut=2025-12-27&locale=zh-HK" },
        protected: false
      },
      {
        id: 7, date: "2025-12-27", label: "Day 7 ¬∑ Dec 27", route: "Lijiang ¬∑ Rest Day + Silver",
        theme: "Slow day & silver craft",
        story: "No alarms, no rushing. We sleep in, wander Shuhe's stone streets, and spend the afternoon crafting our own silver jewelry ‚Äî rings or bracelets to carry this trip home with us. Save our energy for the high altitude days ahead.",
        schedule: [
          { time: "Morning", text: "Sleep in, late breakfast at the hotel" },
          { time: "", text: "No rush ‚Äî this is a rest day" },
          { time: "Noon", text: "Wander Shuhe Old Town, find a sunny caf√©" },
          { time: "Afternoon", text: "üíç Silver jewelry workshop in Lijiang" },
          { time: "", text: "Craft rings or bracelets together" },
          { time: "Evening", text: "Dinner in Shuhe or Lijiang Old Town" },
          { time: "Night", text: "Rooftop drinks, ancient town lights below" }
        ],
        hotel: { name: "Yueshi Yunyue Holiday Villa (ÈòÖÊó∂‰∫ëÁ∫¶)", location: "Shuhe Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=126736658&checkIn=2025-12-27&checkOut=2025-12-28&locale=zh-HK" },
        protected: false
      },
      {
        id: 8, date: "2025-12-28", label: "Day 8 ¬∑ Dec 28", route: "Lijiang ‚Üí Shangri-La",
        theme: "Tiger Leaping Gorge",
        story: "The road to Shangri-La is the journey. We'll stop at Tiger Leaping Gorge where the Jinsha River forces itself through a narrow canyon with terrifying beauty. Then up to the plateau, where the air is thinner and the sky is closer.",
        schedule: [
          { time: "Morning", text: "Begin 4-hour drive to Shangri-La" },
          { time: "", text: "Stop at Tiger Leaping Gorge viewing area" },
          { time: "Afternoon", text: "Arrive Dukezong Old Town" },
          { time: "", text: "Take it slow, drink water, adjust to altitude" },
          { time: "Sunset", text: "Guishan Park ‚Äî spin the giant prayer wheel" }
        ],
        hotel: { name: "Roudan Lianshe Wabisabi (Êüî‰∏πËé≤Ëàç)", location: "Dukezong Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=129143679&checkIn=2025-12-28&checkOut=2025-12-30&locale=zh-HK" },
        protected: false
      },
      {
        id: 9, date: "2025-12-29", label: "Day 9 ¬∑ Dec 29", route: "Shangri-La",
        theme: "Monastery & grassland",
        story: "Morning prayers at the 'Little Potala' monastery, afternoon wandering the winter grasslands of Napa Lake. If the sky stays clear, we'll step out for a short walk under more stars than we've ever seen.",
        schedule: [
          { time: "Morning", text: "Ganden Sumtseling Monastery with guide" },
          { time: "Noon", text: "Simple Tibetan set meal" },
          { time: "Afternoon", text: "Napa Lake winter grassland, birds, open views" },
          { time: "", text: "Visit nomad family if possible, try butter tea" },
          { time: "Night", text: "Short walk for plateau stars if clear" }
        ],
        hotel: { name: "Roudan Lianshe Wabisabi (Êüî‰∏πËé≤Ëàç)", location: "Dukezong Old Town", link: "https://hk.trip.com/hotels/detail/?hotelId=129143679&checkIn=2025-12-28&checkOut=2025-12-30&locale=zh-HK" },
        protected: false
      },
      {
        id: 10, date: "2025-12-30", label: "Day 10 ¬∑ Dec 30", route: "Pudacuo + Napa Lake",
        theme: "National park & grassland sunset",
        story: "Morning in Pudacuo National Park ‚Äî China's first true national park, where winter transforms highland lakes into mirrors of stillness. Then afternoon at Napa Lake, where horses graze on winter grasslands and the sun sets over endless open sky.",
        schedule: [
          { time: "09:30", text: "Drive to Pudacuo National Park" },
          { time: "10:00", text: "üèûÔ∏è Shudu Lake ‚Äî winter stillness and reflection" },
          { time: "12:00", text: "Light lunch in the park" },
          { time: "13:00", text: "Leave Pudacuo, drive to Napa Lake" },
          { time: "14:30", text: "Check into Napa Lake hotel" },
          { time: "15:30", text: "üêé Grassland walk or horse riding" },
          { time: "17:30", text: "üåÖ Sunset over Napa Lake grassland" },
          { time: "19:00", text: "Early dinner and rest ‚Äî big day tomorrow!" }
        ],
        hotel: { name: "Banshan Tanye Manor (ÂçäÂ±±Êé¢ÈáéÂ∫ÑÂõ≠)", location: "Napa Lake", link: "https://hk.trip.com/hotels/detail/?hotelId=109718533&checkIn=2025-12-30&checkOut=2025-12-31&locale=zh-HK" },
        protected: false
      },
      {
        id: 11, date: "2025-12-31", label: "Day 11 ¬∑ Dec 31", route: "Napa Lake ‚Üí Feilai Temple",
        theme: "New Year's Eve under Meili stars",
        story: "The last day of the year. We drive the Yunnan-Tibet road to stand before Meili Snow Mountain ‚Äî one of Tibetan Buddhism's most sacred peaks. As the old year fades, we'll watch the last sunset paint Kawagarbo gold.",
        schedule: [
          { time: "Morning", text: "Drive along Yunnan-Tibet road to Deqin" },
          { time: "", text: "Photo stop at Jinsha River Big Bend" },
          { time: "Afternoon", text: "Arrive Feilai Temple, check into mountain-view hotel" },
          { time: "Sunset", text: "Watch last light of 2025 on Kawagarbo" },
          { time: "Night", text: "New Year's Eve ‚Äî starry sky above Meili" }
        ],
        hotel: { name: "Xueshan Xinglai (Èõ™Â±±ÈÜíÊù•)", location: "Feilai Temple", link: "https://hk.trip.com/hotels/detail/?hotelId=100476519&checkIn=2025-12-31&checkOut=2026-01-01&locale=zh-HK" },
        protected: true
      },
      {
        id: 12, date: "2026-01-01", label: "Day 12 ¬∑ Jan 1", route: "Feilai Temple ‚Üí Shangri-La ‚Üí Kunming",
        theme: "First light, then train to Kunming",
        story: "We wake before dawn, hoping. The 'golden sunrise' on Meili is rare ‚Äî most pilgrims wait years to see it. After this sacred moment, we drive back to Shangri-La and take the evening train through the mountains to Kunming.",
        schedule: [
          { time: "Dawn", text: "Early wake-up, wait for possible golden sunrise" },
          { time: "", text: "Even without perfect light, this moment matters" },
          { time: "08:00", text: "Breakfast, pack up, say goodbye to Meili" },
          { time: "09:00", text: "Start 5-hour drive to Shangri-La" },
          { time: "14:00", text: "Arrive Shangri-La, lunch near the station" },
          { time: "18:50", text: "üöÑ C124 Shangri-La ‚Üí Kunming" },
          { time: "23:57", text: "Arrive Kunming, taxi to hotel" }
        ],
        hotel: { name: "InterContinental Kunming (ÊòÜÊòéÊ¥≤ÈôÖÈÖíÂ∫ó)", location: "Kunming", link: "https://hk.trip.com/hotels/kunming-hotel-detail-472903/intercontinental-hotels-kunming-by-ihg/?locale=zh-HK&curr=HKD" },
        protected: false
      },
      {
        id: 13, date: "2026-01-02", label: "Day 13 ¬∑ Jan 2", route: "Kunming ¬∑ Friends Day",
        theme: "A day with friends in Spring City",
        story: "Finally, a day to breathe. We'll wake up late, feed the red-billed gulls at Cuihu Lake, then meet up with friends for lunch and explore Kunming together. No rushing, no schedules ‚Äî just good company in the eternal spring city.",
        schedule: [
          { time: "Morning", text: "Sleep in! Then Cuihu Lake ‚Äî feed the seagulls" },
          { time: "", text: "Winter brings thousands of gulls from Siberia" },
          { time: "Noon", text: "üéâ Lunch with friends ‚Äî local recommendations" },
          { time: "Afternoon", text: "Explore Kunming with friends" },
          { time: "", text: "Jinma Biji Fang, Nanping Street, etc." },
          { time: "Evening", text: "Dinner together, last night in Yunnan" }
        ],
        hotel: { name: "InterContinental Kunming (ÊòÜÊòéÊ¥≤ÈôÖÈÖíÂ∫ó)", location: "Kunming", link: "https://hk.trip.com/hotels/kunming-hotel-detail-472903/intercontinental-hotels-kunming-by-ihg/?locale=zh-HK&curr=HKD" },
        protected: false
      },
      {
        id: 14, date: "2026-01-03", label: "Day 14 ¬∑ Jan 3", route: "Kunming ‚Üí Shenzhen",
        theme: "Back with memories",
        story: "The last morning. Pack up slowly, maybe grab one more bowl of rice noodles. Then the flight home, carrying 14 days of mountains, lakes, and snow inside us. Yunnan will always be there, waiting for our return.",
        schedule: [
          { time: "Morning", text: "Pack up, last breakfast in Yunnan" },
          { time: "", text: "Maybe one more bowl of Guoqiao rice noodles" },
          { time: "13:15", text: "‚úàÔ∏è CA3558 Kunming ‚Üí Shenzhen" },
          { time: "15:15", text: "Arrive home" },
          { time: "", text: "Trip ends. Yunnan chapter stays." }
        ],
        hotel: null,
        protected: false
      }
    ];

    // Helpers
    const STORAGE_KEY = "yn_trip_v5";
    const ROOM_PREF_KEY = "yn_room_prefs_v2";

    function getToday() {
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate());
    }

    const tripStart = new Date(2025, 11, 21); // Êúà‰ªΩ‰ªé0ÂºÄÂßãÔºå11=12Êúà
    const tripEnd = new Date(2026, 0, 3);    // 0=1Êúà

    function getMode() {
      const today = getToday();
      // ÊóÖË°åÂâçÔºöBlind Box Ê®°ÂºèÔºàÂèØ‰ª•ÊäΩ3Â§©È¢ÑËßàÔºâ
      if (today < tripStart) return "pre";
      // ÊóÖË°åÂêéÔºà1Êúà3Êó•‰πãÂêéÔºâÔºöMemory Ê®°ÂºèÔºàÂÖ®ÈÉ®Ëß£ÈîÅÔºâ
      if (today > tripEnd) return "post";
      // ÊóÖË°å‰∏≠Ôºà12Êúà21Êó•-1Êúà3Êó•ÔºâÔºöÂÆûÊó∂Ëß£ÈîÅÊ®°Âºè
      return "during";
    }

    function formatDisplayDate(date) {
      return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    function isSameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    }

    function loadRandom() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch { return []; }
    }
    function saveRandom(ids) { localStorage.setItem(STORAGE_KEY, JSON.stringify(ids)); }
    function clearRandom() { localStorage.removeItem(STORAGE_KEY); }

    function loadRoomPrefs() {
      try { return JSON.parse(localStorage.getItem(ROOM_PREF_KEY)) || {}; }
      catch { return {}; }
    }
    function saveRoomPref(hotelId, pref) {
      const prefs = loadRoomPrefs();
      prefs[hotelId] = pref;
      localStorage.setItem(ROOM_PREF_KEY, JSON.stringify(prefs));
    }

    function pickRandom(n) {
      const available = itinerary.filter(d => !d.protected).map(d => d.id);
      for (let i = available.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [available[i], available[j]] = [available[j], available[i]];
      }
      return available.slice(0, n);
    }

    // DOM Elements
    const todayDateEl = document.getElementById("todayDate");
    const statusModeEl = document.getElementById("statusMode");
    const statusTitleEl = document.getElementById("statusTitle");
    const statusDescEl = document.getElementById("statusDesc");
    const countdownEl = document.getElementById("countdown");
    const currentDayBannerEl = document.getElementById("currentDayBanner");
    const controlsEl = document.getElementById("controls");
    const randomBtn = document.getElementById("randomBtn");
    const resetBtn = document.getElementById("resetBtn");
    const hintEl = document.getElementById("hint");
    const cardsContainer = document.getElementById("cardsContainer");

    // Modal
    const modal = document.getElementById("hotelModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalIframe = document.getElementById("modalIframe");
    const modalClose = document.getElementById("modalClose");
    const modalRoomInput = document.getElementById("modalRoomInput");
    const modalSaveBtn = document.getElementById("modalSaveBtn");
    let currentHotelId = null;

    modalClose.onclick = () => { modal.classList.remove("active"); modalIframe.src = ""; };
    modal.onclick = (e) => { if (e.target === modal) { modal.classList.remove("active"); modalIframe.src = ""; }};

    modalSaveBtn.onclick = () => {
      const pref = modalRoomInput.value.trim();
      if (pref && currentHotelId) {
        saveRoomPref(currentHotelId, pref);
        logEvent("room_preference_saved", { hotelId: currentHotelId, preference: pref });
        modal.classList.remove("active");
        modalIframe.src = "";
        render();
      }
    };

    function openHotelModal(hotel, dayId) {
      currentHotelId = `day-${dayId}`;
      modalTitle.textContent = hotel.name;
      modalIframe.src = hotel.link;
      const prefs = loadRoomPrefs();
      modalRoomInput.value = prefs[currentHotelId] || "";
      modal.classList.add("active");
      logEvent("hotel_modal_opened", { dayId, hotelName: hotel.name });
    }

    // Stars
    function createStars() {
      const container = document.getElementById("stars");
      const types = [
        { class: 'dust', count: 80 },
        { class: 'small', count: 50 },
        { class: 'medium', count: 25 },
        { class: 'bright', count: 10 }
      ];

      types.forEach(type => {
        for (let i = 0; i < type.count; i++) {
          const star = document.createElement("div");
          star.className = `star ${type.class}`;
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.animationDelay = Math.random() * 5 + "s";
          container.appendChild(star);
        }
      });

      // Meteors
      for (let i = 0; i < 3; i++) {
        const meteor = document.createElement("div");
        meteor.className = "meteor";
        meteor.style.top = Math.random() * 40 + "%";
        meteor.style.left = Math.random() * 50 + "%";
        meteor.style.animationDelay = (i * 10 + Math.random() * 5) + "s";
        container.appendChild(meteor);
      }
    }

    // Countdown
    function updateCountdown() {
      const today = getToday();
      const diff = tripStart - today;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));

      if (days > 0) {
        countdownEl.innerHTML = `
          <div class="countdown-item">
            <div class="countdown-num">${days}</div>
            <div class="countdown-label">days until departure</div>
          </div>
        `;
      } else {
        countdownEl.innerHTML = "";
      }
    }

    // Current Day Banner
    function renderCurrentDayBanner() {
      const today = getToday();
      const currentDay = itinerary.find(d => isSameDay(new Date(d.date), today));

      if (currentDay) {
        currentDayBannerEl.innerHTML = `
          <div class="current-day-banner">
            <div class="current-day-label">‚ú¶ Today's Journey ‚ú¶</div>
            <div class="current-day-title">${currentDay.label}</div>
            <div class="current-day-theme">${currentDay.theme}</div>
          </div>
        `;
      } else {
        currentDayBannerEl.innerHTML = "";
      }
    }

    // Card Creation
    function createCard(day, unlocked, isToday) {
      const card = document.createElement("article");
      card.className = `day-card ${unlocked ? "unlocked" : "locked"} ${isToday ? "today" : ""}`;
      card.dataset.id = day.id;

      const prefs = loadRoomPrefs();
      const savedPref = prefs[`day-${day.id}`];

      let scheduleHTML = "";
      if (day.schedule) {
        scheduleHTML = day.schedule.map(item => `
          <div class="schedule-item">
            ${item.time ? `<div class="schedule-time">${item.time}</div>` : '<div class="schedule-time"></div>'}
            <div class="schedule-dot"></div>
            <div class="schedule-text">${item.text}</div>
          </div>
        `).join("");
      }

      let hotelHTML = "";
      if (day.hotel && unlocked) {
        hotelHTML = `
          <div class="hotel-box">
            <div class="hotel-label">Tonight's Stay</div>
            <div class="hotel-name">${day.hotel.name}</div>
            <div class="hotel-location">${day.hotel.location}</div>
            <div class="hotel-actions">
              ${day.hotel.link ? `
                <button class="hotel-btn primary" data-hotel='${JSON.stringify(day.hotel)}' data-day="${day.id}">Browse Rooms</button>
                <a href="${day.hotel.link}" target="_blank" class="hotel-btn secondary">Open in New Tab</a>
              ` : '<span style="font-size: 0.75rem; color: var(--text-dim);">Booking link TBD</span>'}
            </div>
            ${savedPref ? `
              <div class="room-pref">
                <div class="room-pref-label">Your preference:</div>
                <div class="room-pref-value">${savedPref}</div>
              </div>
            ` : ''}
          </div>
        `;
      }

      let statusClass = unlocked ? (isToday ? "today" : "") : "locked";
      let statusText = unlocked ? (isToday ? "Today" : "Unlocked") : "Locked";

      card.innerHTML = `
        <div class="card-header">
          <div>
            <div class="card-date">${day.date}</div>
            <div class="card-title">${day.label}</div>
            <div class="card-theme">${day.theme}</div>
          </div>
          <div style="display: flex; align-items: center;">
            <div class="card-status ${statusClass}">
              <span class="status-dot"></span>
              <span>${statusText}</span>
            </div>
            ${unlocked ? '<span class="expand-icon">‚ñº</span>' : ''}
          </div>
        </div>
        <div class="card-body">
          <div class="card-content">
            ${day.story ? `
              <div class="story-box">
                <div class="story-label">The Story</div>
                <div class="story-text">${day.story}</div>
              </div>
            ` : ''}
            ${scheduleHTML ? `
              <div class="schedule-section">
                <div class="schedule-label">The Plan</div>
                ${scheduleHTML}
              </div>
            ` : ''}
            ${hotelHTML}
          </div>
        </div>
        ${!unlocked ? `
          <div class="locked-overlay">
            <div class="lock-icon">üîí</div>
            <div class="lock-text">Unlocks on ${day.date}</div>
          </div>
        ` : ''}
      `;

      // Expand/collapse for unlocked cards
      if (unlocked) {
        const header = card.querySelector('.card-header');
        const body = card.querySelector('.card-body');
        header.onclick = () => {
          const isExpanded = body.classList.contains('expanded');
          body.classList.toggle('expanded');
          card.classList.toggle('expanded');
          logEvent("card_toggled", { dayId: day.id, expanded: !isExpanded });
        };
      }

      // Hotel button
      const hotelBtn = card.querySelector('.hotel-btn.primary');
      if (hotelBtn) {
        hotelBtn.onclick = (e) => {
          e.stopPropagation();
          const hotel = JSON.parse(hotelBtn.dataset.hotel);
          openHotelModal(hotel, hotelBtn.dataset.day);
        };
      }

      return card;
    }

    // Render Functions
    function render() {
      const mode = getMode();
      const today = getToday();

      todayDateEl.textContent = formatDisplayDate(today);
      updateCountdown();
      renderCurrentDayBanner();

      if (mode === "pre") {
        statusModeEl.textContent = "Blind Box Mode";
        statusDescEl.textContent = "Pick 3 random days to preview. The rest stays a surprise.";
        controlsEl.style.display = "flex";
        renderPreTrip();
      } else if (mode === "during") {
        statusModeEl.textContent = "On The Road";
        statusDescEl.textContent = "Days unlock as you travel. Click any unlocked card to expand.";
        controlsEl.style.display = "none";
        renderDuringTrip(today);
      } else {
        statusModeEl.textContent = "Memory Mode";
        statusDescEl.textContent = "All days unlocked. Your travel diary.";
        controlsEl.style.display = "none";
        renderPostTrip();
      }
    }

    function renderPreTrip() {
      const selected = loadRandom();
      cardsContainer.innerHTML = "";

      if (!selected.length) {
        hintEl.textContent = "Click above to reveal three days from your journey";
        resetBtn.style.display = "none";

        const placeholder = document.createElement("div");
        placeholder.className = "placeholder";
        placeholder.innerHTML = `
          <div class="placeholder-icon">üì¶</div>
          <div class="placeholder-text">14 days waiting to be discovered</div>
          <div class="placeholder-sub">Draw 3 to preview</div>
        `;
        cardsContainer.appendChild(placeholder);
        return;
      }

      hintEl.textContent = "3 days revealed. Click each card to see more.";
      resetBtn.style.display = "inline-flex";

      const wrapper = document.createElement("div");
      wrapper.className = "cards-grid";

      itinerary
        .filter(d => selected.includes(d.id))
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .forEach((day, i) => {
          const card = createCard(day, true, false);
          card.classList.add(`stagger-${i + 1}`);
          wrapper.appendChild(card);
          setTimeout(() => card.classList.add('visible'), 50);
        });

      cardsContainer.appendChild(wrapper);
    }

    function renderDuringTrip(today) {
      cardsContainer.innerHTML = "";
      hintEl.textContent = "";

      const wrapper = document.createElement("div");
      wrapper.className = "timeline";

      itinerary.forEach((day, i) => {
        const dayDate = new Date(day.date);
        const unlocked = dayDate <= today;
        const isToday = isSameDay(dayDate, today);
        const card = createCard(day, unlocked, isToday);
        card.classList.add(`stagger-${Math.min(i + 1, 7)}`);
        wrapper.appendChild(card);
        setTimeout(() => card.classList.add('visible'), 100 + i * 50);
      });

      cardsContainer.appendChild(wrapper);
    }

    function renderPostTrip() {
      cardsContainer.innerHTML = "";
      hintEl.textContent = "";

      const wrapper = document.createElement("div");
      wrapper.className = "timeline";

      itinerary.forEach((day, i) => {
        const card = createCard(day, true, false);
        card.classList.add(`stagger-${Math.min(i + 1, 7)}`);
        wrapper.appendChild(card);
        setTimeout(() => card.classList.add('visible'), 100 + i * 50);
      });

      cardsContainer.appendChild(wrapper);
    }

    // Event Listeners
    randomBtn.onclick = () => {
      const ids = pickRandom(3);
      saveRandom(ids);
      logEvent("random_draw", { pickedIds: ids });
      render();
    };

    resetBtn.onclick = () => {
      const prev = loadRandom();
      clearRandom();
      logEvent("reset_draw", { previousPicks: prev });
      render();
    };

    // Initialize
    createStars();
    logEvent("page_load", { mode: getMode(), existingPicks: loadRandom() });
    render();
  </script>
</body>
</html>
